{% extends "base.html" %}

{% block extra_cssstyle %}
{% endblock %}

{% block extra_javascript %}
{% endblock %}

{% block title %}Email{% endblock %}
{% block content %}


<div id="spinner"></div>


<div id="page">

<div id="leftbar">
	<div id="leftbar_toolbar">
		<a href="#"><img src="/site_media/images/mail-get.png" alt="Check For New Mail" title="Check For New Mail" /></a>
		<a href="#" id="newmaillink"><img src="/site_media/images/mail-new.png" alt="New Mail" title="Compose New Mail" /></a>
		<a href="#"><img src="/site_media/images/system-log-out.png" alt="Logout" title="Logout" /></a>
        <a href="#" id="prefslink"><img src="/site_media/images/prefs.png" alt="Prefs" title="Preferences" /></a>
		<a href="#" onclick="showSpinner(); return false;">Show</a>
		<a href="#" onclick="hideSpinner(); return false;">Hide</a>
	</div>
    <div id="folderlist">
		<div id="foldertree"></div>
    </div>
    <div id="leftbar_bottom_info">
        <p>imap times:</p>
        <p>{{ con_time }}</p>
        <p>{{ log_time }}</p>
        <p>{{ list_time }}</p>
    </div>
</div>

<!-- FIXME: move this out to a js file -->
<script type="text/javascript">
var tree;
var nodes = {};

function initFolderTree() {

	tree = new YAHOO.widget.TreeView('foldertree');

	function onLabelClick(node) {
		// we need to rebuild the folder name from the (sub)dir names
		realfoldername = node.label;
		while(node.parent.depth != -1) {
			realfoldername = node.parent.label+'.'+realfoldername;
			node = node.parent;
		}

		_$('#contentpane').populate('msglist/'+realfoldername+'/');
	}

{% for f in maildir %}
	f = '{{ f }}'.split('.');
	for(var i=0 ; i < f.length ; i++) {
		// f[i] should equal an actual (sub)dir name (i.e. the part between .'s)
		if(i == 0)
			root = tree.getRoot();
		else
			root = nodes[f[i-1]];
		nodename = f[i].replace(' ', '_'); // clean spaces out
		if(!nodes[nodename]) {
			nodes[nodename] = new YAHOO.widget.TextNode(f[i], root, false);
			nodes[nodename].onLabelClick = onLabelClick;
		}
	}
{% endfor %}

	tree.draw();
}
YAHOO.util.Event.addListener(window, 'load', initFolderTree, true);

</script>

<noscript><h1>This site requires javascript to be enabled</h1></noscript>

<div id="contentpane">
{% include "mail/msglist.html" %}
</div>



</div><!-- end page -->

{% endblock %}